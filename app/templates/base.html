<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ì™€êµ¬ì„¼ì˜ í™ˆ{% endblock %}</title>
    
    <!-- ë³´ì•ˆ ë©”íƒ€ íƒœê·¸ -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- ì„±ëŠ¥ ìµœì í™”: DNS prefetch ë° preconnect -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- SEO ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="{% block description %}ì™€êµ¬ì„¼ ì›¹ì‚¬ì´íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ë¸”ë¡œê·¸, ì‹œë®¬ë ˆì´ì…˜, í”„ë¡œê·¸ë˜ë° ì½˜í…ì¸ ë¥¼ ì œê³µí•©ë‹ˆë‹¤.{% endblock %}">
    <meta name="keywords" content="ì™€êµ¬ì„¼, wagusen, ë¸”ë¡œê·¸, ì‹œë®¬ë ˆì´ì…˜, í”„ë¡œê·¸ë˜ë°, Python, JavaScript">
    <meta name="author" content="ì™€êµ¬ì„¼">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph ë©”íƒ€ íƒœê·¸ -->
    <meta property="og:title" content="{% block og_title %}{% block title %}ì™€êµ¬ì„¼ì˜ í™ˆ{% endblock %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% block description %}ì™€êµ¬ì„¼ ì›¹ì‚¬ì´íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.{% endblock %}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="ì™€êµ¬ì„¼">
    <meta property="og:locale" content="ko_KR">
    
    <!-- Twitter Card ë©”íƒ€ íƒœê·¸ -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{% block twitter_title %}{% block title %}ì™€êµ¬ì„¼ì˜ í™ˆ{% endblock %}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{% block description %}ì™€êµ¬ì„¼ ì›¹ì‚¬ì´íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.{% endblock %}{% endblock %}">
    
    <!-- íŒŒë¹„ì½˜ ìµœì í™” -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon-16x16.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- ì•„ì´ì½˜ í°íŠ¸ ìµœì í™” -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"></noscript>
    
    <!-- CSS ìµœì í™” -->
    <link rel="preload" href="{{ url_for('static', filename='css/main.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}"></noscript>
    
    <!-- ì¤‘ìš” CSS ì¸ë¼ì¸ (Critical CSS) -->
    <style>
        /* Critical CSS for above-the-fold content */
        :root {
            --primary-500: #3b82f6;
            --text-primary: rgb(6, 7, 39);
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --border-color: #e5e7eb;
            --font-sans: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        html.dark-theme {
            --text-primary: #f1f5f9;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --border-color: #334155;
        }
        
        body {
            font-family: var(--font-sans);
            color: var(--text-primary);
            background-color: var(--bg-primary);
            margin: 0;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            z-index: 1020;
            backdrop-filter: blur(10px);
        }
        
        main {
            padding-top: 72px;
            margin-bottom: 4rem;
        }
        
        /* Skip link for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-500);
            color: white;
            padding: 8px;
            border-radius: 4px;
            text-decoration: none;
            z-index: 9999;
            font-weight: 600;
        }
        
        .skip-link:focus {
            top: 6px;
        }
    </style>
    
    {% block head %}{% endblock %}
    
    <!-- êµ¬ì¡°í™”ëœ ë°ì´í„° (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{% block schema_type %}Website{% endblock %}",
        "name": "ì™€êµ¬ì„¼",
        "url": "{{ request.url_root }}",
        "description": "ì™€êµ¬ì„¼ì˜ ê°œì¸ ì›¹ì‚¬ì´íŠ¸ - ë¸”ë¡œê·¸, ì‹œë®¬ë ˆì´ì…˜, í”„ë¡œê·¸ë˜ë° ì½˜í…ì¸ ",
        "author": {
            "@type": "Person",
            "name": "ì™€êµ¬ì„¼"
        },
        "inLanguage": "ko-KR"
    }
    </script>
</head>
<body>
    <!-- ì ‘ê·¼ì„±: Skip Link -->
    <a href="#main-content" class="skip-link">ë©”ì¸ ì½˜í…ì¸ ë¡œ ê±´ë„ˆë›°ê¸°</a>
    
    <!-- í—¤ë” -->
    <header class="top-header" role="banner">
        <div class="container">
            <!-- ë¡œê³  ì˜ì—­ -->
            <div class="logo-area">
                <a href="{{ url_for('main.index') }}" class="logo" aria-label="ì™€êµ¬ì„¼ í™ˆí˜ì´ì§€ë¡œ ì´ë™">
                    <picture>
                        <source srcset="{{ url_for('static', filename='img/logo.webp') }}" type="image/webp">
                        <img src="{{ url_for('static', filename='img/logo.png') }}" 
                             alt="ì™€êµ¬ì„¼ ë¡œê³ "
                             width="36"
                             height="36"
                             loading="eager"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                    </picture>
                    <span style="display: none; font-size: 24px;" aria-hidden="true">ğŸ </span>
                    <span class="site-name">ì™€êµ¬ì„¼</span>
                </a>
            </div>
            
            <!-- ë°ìŠ¤í¬í†± ë„¤ë¹„ê²Œì´ì…˜ - ì ‘ê·¼ì„± ê°œì„  -->
            <nav class="desktop-nav" role="navigation" aria-label="ì£¼ ë©”ë‰´">
                <ul role="menubar">
                    <li role="none">
                        <a href="{{ url_for('posts.index') }}" 
                           role="menuitem"
                           {% if request.endpoint and 'posts' in request.endpoint %}
                           class="active" aria-current="page"
                           {% endif %}
                           aria-label="ë¸”ë¡œê·¸ í˜ì´ì§€ë¡œ ì´ë™">
                            ë¸”ë¡œê·¸
                        </a>
                    </li>
                    <li role="none">
                        <a href="{{ url_for('simulation.index') }}" 
                           role="menuitem"
                           {% if request.endpoint and 'simulation' in request.endpoint %}
                           class="active" aria-current="page"
                           {% endif %}
                           aria-label="ì‹œë®¬ë ˆì´ì…˜ í˜ì´ì§€ë¡œ ì´ë™">
                            ì‹œë®¬ë ˆì´ì…˜
                        </a>
                    </li>
                    <li role="none">
                        <a href="{{ url_for('main.about') }}" 
                           role="menuitem"
                           {% if request.endpoint == 'main.about' %}
                           class="active" aria-current="page"
                           {% endif %}
                           aria-label="ì†Œê°œ í˜ì´ì§€ë¡œ ì´ë™">
                            ì†Œê°œ
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- í—¤ë” ì»¨íŠ¸ë¡¤ -->
            <div class="header-controls">
                <!-- í…Œë§ˆ í† ê¸€ ë²„íŠ¼ - ì ‘ê·¼ì„± ê°œì„  -->
                <button class="theme-toggle" 
                        id="theme-toggle" 
                        aria-label="í…Œë§ˆ ë³€ê²½" 
                        aria-pressed="false"
                        title="ë‹¤í¬ ëª¨ë“œ/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜">
                    <i class="fas fa-lightbulb light-icon" aria-hidden="true"></i>
                    <i class="fas fa-lightbulb dark-icon" aria-hidden="true"></i>
                    <span class="sr-only" id="theme-status">í˜„ì¬ ë¼ì´íŠ¸ ëª¨ë“œ</span>
                </button>
                
                <!-- ëª¨ë°”ì¼ í† ê¸€ - ì ‘ê·¼ì„± ê°œì„  -->
                <button class="mobile-toggle" 
                        id="mobile-toggle" 
                        aria-label="ëª¨ë°”ì¼ ë©”ë‰´ ì—´ê¸°" 
                        aria-expanded="false"
                        aria-controls="mobile-nav"
                        aria-haspopup="true">
                    <span class="hamburger-line" aria-hidden="true"></span>
                    <span class="hamburger-line" aria-hidden="true"></span>
                    <span class="hamburger-line" aria-hidden="true"></span>
                    <span class="sr-only">ë©”ë‰´</span>
                </button>
            </div>
        </div>
    </header>
    
    <!-- ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ - ì ‘ê·¼ì„± ëŒ€í­ ê°œì„  -->
    <nav class="mobile-nav" 
         id="mobile-nav" 
         role="dialog" 
         aria-modal="true" 
         aria-labelledby="mobile-nav-title"
         aria-hidden="true"
         tabindex="-1">
        <div class="mobile-nav-header">
            <h2 class="mobile-nav-title" id="mobile-nav-title">ë©”ë‰´</h2>
            <button class="mobile-nav-close" 
                    id="mobile-nav-close" 
                    aria-label="ë©”ë‰´ ë‹«ê¸°"
                    title="ë©”ë‰´ ë‹«ê¸°">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
        <div class="mobile-nav-content" role="menu">
            <a href="{{ url_for('posts.index') }}" 
               class="mobile-nav-link" 
               role="menuitem"
               tabindex="-1">
                <span>ë¸”ë¡œê·¸</span>
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </a>
            <a href="{{ url_for('simulation.index') }}" 
               class="mobile-nav-link" 
               role="menuitem"
               tabindex="-1">
                <span>ì‹œë®¬ë ˆì´ì…˜</span>
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </a>
            <a href="{{ url_for('main.about') }}" 
               class="mobile-nav-link" 
               role="menuitem"
               tabindex="-1">
                <span>ì†Œê°œ</span>
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </a>
            <div class="mobile-theme-item">
                <div class="mobile-nav-link" role="menuitem" tabindex="-1">
                    <span>ë‹¤í¬ ëª¨ë“œ</span>
                    <button class="theme-switch" 
                            id="mobile-theme-toggle"
                            role="switch"
                            aria-checked="false"
                            aria-label="ë‹¤í¬ ëª¨ë“œ í† ê¸€"
                            tabindex="-1">
                        <span class="theme-switch-slider" aria-hidden="true"></span>
                        <span class="sr-only">ë‹¤í¬ ëª¨ë“œ ì „í™˜</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- ëª¨ë°”ì¼ ë©”ë‰´ ì˜¤ë²„ë ˆì´ -->
    <div class="mobile-overlay" 
         id="mobile-overlay" 
         aria-hidden="true"
         role="presentation"></div>
    
    <!-- ë©”ì¸ ì½˜í…ì¸  - ì ‘ê·¼ì„± landmark -->
    <main id="main-content" role="main" tabindex="-1">
        {% block content %}{% endblock %}
    </main>
    
    <!-- í‘¸í„° - ì ‘ê·¼ì„± ê°œì„  -->
    <footer role="contentinfo" aria-label="ì‚¬ì´íŠ¸ ì •ë³´">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <a href="{{ url_for('main.index') }}" 
                       class="footer-logo"
                       aria-label="ì™€êµ¬ì„¼ í™ˆí˜ì´ì§€ë¡œ ì´ë™">
                        <picture>
                            <source srcset="{{ url_for('static', filename='img/footer-logo.webp') }}" type="image/webp">
                            <img src="{{ url_for('static', filename='img/footer-logo.gif') }}" 
                                 alt="ì™€êµ¬ì„¼ ë¡œê³ "
                                 width="40"
                                 height="40"
                                 loading="lazy"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                        </picture>
                        <span style="display: none; font-size: 20px;" aria-hidden="true">ğŸ </span>
                    </a>
                    <p>&copy; <span id="current-year">2024</span> ì™€êµ¬ì„¼. All rights reserved.</p>
                </div>
                <nav class="footer-links" aria-label="ì†Œì…œ ë¯¸ë””ì–´ ë§í¬">
                    <a href="https://github.com/wagusen" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       aria-label="GitHub í”„ë¡œí•„ ë³´ê¸° (ìƒˆ ì°½ì—ì„œ ì—´ë¦¼)">
                        <i class="fab fa-github" aria-hidden="true"></i>
                        <span>GitHub</span>
                    </a>
                    <a href="mailto:contact@wagusen.com"
                       aria-label="ì´ë©”ì¼ ë³´ë‚´ê¸°">
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                        <span>Email</span>
                    </a>
                </nav>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript ìµœì í™” -->
    <script>
        // Critical JavaScript ì¸ë¼ì¸ (í…Œë§ˆ ê´€ë¦¬)
        (function() {
            // FOUC ë°©ì§€ë¥¼ ìœ„í•œ í…Œë§ˆ ì¦‰ì‹œ ì ìš©
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark-theme');
            }
            
            // í˜„ì¬ ì—°ë„ ì—…ë°ì´íŠ¸
            const currentYear = new Date().getFullYear();
            const yearElement = document.getElementById('current-year');
            if (yearElement) {
                yearElement.textContent = currentYear;
            }
        })();
    </script>
    
    <!-- ì„±ëŠ¥ ìµœì í™”: ë©”ì¸ JavaScript ì§€ì—° ë¡œë”© -->
    <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- ì ‘ê·¼ì„±: ìŠ¤í¬ë¦° ë¦¬ë” ì „ìš© ë¼ì´ë¸Œ ì˜ì—­ -->
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="live-region"></div>
    
    {% block scripts %}{% endblock %}
    
    <!-- ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (PWA ì§€ì›) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>