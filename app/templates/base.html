<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}와구센의 홈{% endblock %}</title>
    
    <!-- 보안 메타 태그 -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- 성능 최적화: DNS prefetch 및 preconnect -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- SEO 메타 태그 -->
    <meta name="description" content="{% block description %}와구센 웹사이트에 오신 것을 환영합니다. 블로그, 시뮬레이션, 프로그래밍 콘텐츠를 제공합니다.{% endblock %}">
    <meta name="keywords" content="와구센, wagusen, 블로그, 시뮬레이션, 프로그래밍, Python, JavaScript">
    <meta name="author" content="와구센">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph 메타 태그 -->
    <meta property="og:title" content="{% block og_title %}{% block title %}와구센의 홈{% endblock %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% block description %}와구센 웹사이트에 오신 것을 환영합니다.{% endblock %}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="와구센">
    <meta property="og:locale" content="ko_KR">
    
    <!-- Twitter Card 메타 태그 -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{% block twitter_title %}{% block title %}와구센의 홈{% endblock %}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{% block description %}와구센 웹사이트에 오신 것을 환영합니다.{% endblock %}{% endblock %}">
    
    <!-- 파비콘 최적화 -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon-16x16.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- 아이콘 폰트 최적화 -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"></noscript>
    
    <!-- CSS 최적화 -->
    <link rel="preload" href="{{ url_for('static', filename='css/main.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}"></noscript>
    
    <!-- 중요 CSS 인라인 (Critical CSS) -->
    <style>
        /* Critical CSS for above-the-fold content */
        :root {
            --primary-500: #3b82f6;
            --text-primary: rgb(6, 7, 39);
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --border-color: #e5e7eb;
            --font-sans: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        html.dark-theme {
            --text-primary: #f1f5f9;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --border-color: #334155;
        }
        
        body {
            font-family: var(--font-sans);
            color: var(--text-primary);
            background-color: var(--bg-primary);
            margin: 0;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            z-index: 1020;
            backdrop-filter: blur(10px);
        }
        
        main {
            padding-top: 72px;
            margin-bottom: 4rem;
        }
        
        /* Skip link for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-500);
            color: white;
            padding: 8px;
            border-radius: 4px;
            text-decoration: none;
            z-index: 9999;
            font-weight: 600;
        }
        
        .skip-link:focus {
            top: 6px;
        }
    </style>
    
    {% block head %}{% endblock %}
    
    <!-- 구조화된 데이터 (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{% block schema_type %}Website{% endblock %}",
        "name": "와구센",
        "url": "{{ request.url_root }}",
        "description": "와구센의 개인 웹사이트 - 블로그, 시뮬레이션, 프로그래밍 콘텐츠",
        "author": {
            "@type": "Person",
            "name": "와구센"
        },
        "inLanguage": "ko-KR"
    }
    </script>
</head>
<body>
    <!-- 접근성: Skip Link -->
    <a href="#main-content" class="skip-link">메인 콘텐츠로 건너뛰기</a>
    
    <!-- 헤더 -->
    <header class="top-header" role="banner">
        <div class="container">
            <!-- 로고 영역 -->
            <div class="logo-area">
                <a href="{{ url_for('main.index') }}" class="logo" aria-label="와구센 홈페이지로 이동">
                    <picture>
                        <source srcset="{{ url_for('static', filename='img/logo.webp') }}" type="image/webp">
                        <img src="{{ url_for('static', filename='img/logo.png') }}" 
                             alt="와구센 로고"
                             width="36"
                             height="36"
                             loading="eager"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                    </picture>
                    <span style="display: none; font-size: 24px;" aria-hidden="true">🏠</span>
                    <span class="site-name">와구센</span>
                </a>
            </div>
            
            <!-- 데스크톱 네비게이션 - 접근성 개선 -->
            <nav class="desktop-nav" role="navigation" aria-label="주 메뉴">
                <ul role="menubar">
                    <li role="none">
                        <a href="{{ url_for('posts.index') }}" 
                           role="menuitem"
                           {% if request.endpoint and 'posts' in request.endpoint %}
                           class="active" aria-current="page"
                           {% endif %}
                           aria-label="블로그 페이지로 이동">
                            블로그
                        </a>
                    </li>
                    <li role="none">
                        <a href="{{ url_for('simulation.index') }}" 
                           role="menuitem"
                           {% if request.endpoint and 'simulation' in request.endpoint %}
                           class="active" aria-current="page"
                           {% endif %}
                           aria-label="시뮬레이션 페이지로 이동">
                            시뮬레이션
                        </a>
                    </li>
                    <li role="none">
                        <a href="{{ url_for('main.about') }}" 
                           role="menuitem"
                           {% if request.endpoint == 'main.about' %}
                           class="active" aria-current="page"
                           {% endif %}
                           aria-label="소개 페이지로 이동">
                            소개
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- 헤더 컨트롤 -->
            <div class="header-controls">
                <!-- 테마 토글 버튼 - 접근성 개선 -->
                <button class="theme-toggle" 
                        id="theme-toggle" 
                        aria-label="테마 변경" 
                        aria-pressed="false"
                        title="다크 모드/라이트 모드 전환">
                    <i class="fas fa-lightbulb light-icon" aria-hidden="true"></i>
                    <i class="fas fa-lightbulb dark-icon" aria-hidden="true"></i>
                    <span class="sr-only" id="theme-status">현재 라이트 모드</span>
                </button>
                
                <!-- 모바일 토글 - 접근성 개선 -->
                <button class="mobile-toggle" 
                        id="mobile-toggle" 
                        aria-label="모바일 메뉴 열기" 
                        aria-expanded="false"
                        aria-controls="mobile-nav"
                        aria-haspopup="true">
                    <span class="hamburger-line" aria-hidden="true"></span>
                    <span class="hamburger-line" aria-hidden="true"></span>
                    <span class="hamburger-line" aria-hidden="true"></span>
                    <span class="sr-only">메뉴</span>
                </button>
            </div>
        </div>
    </header>
    
    <!-- 모바일 네비게이션 - 접근성 대폭 개선 -->
    <nav class="mobile-nav" 
         id="mobile-nav" 
         role="dialog" 
         aria-modal="true" 
         aria-labelledby="mobile-nav-title"
         aria-hidden="true"
         tabindex="-1">
        <div class="mobile-nav-header">
            <h2 class="mobile-nav-title" id="mobile-nav-title">메뉴</h2>
            <button class="mobile-nav-close" 
                    id="mobile-nav-close" 
                    aria-label="메뉴 닫기"
                    title="메뉴 닫기">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
        <div class="mobile-nav-content" role="menu">
            <a href="{{ url_for('posts.index') }}" 
               class="mobile-nav-link" 
               role="menuitem"
               tabindex="-1">
                <span>블로그</span>
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </a>
            <a href="{{ url_for('simulation.index') }}" 
               class="mobile-nav-link" 
               role="menuitem"
               tabindex="-1">
                <span>시뮬레이션</span>
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </a>
            <a href="{{ url_for('main.about') }}" 
               class="mobile-nav-link" 
               role="menuitem"
               tabindex="-1">
                <span>소개</span>
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </a>
            <div class="mobile-theme-item">
                <div class="mobile-nav-link" role="menuitem" tabindex="-1">
                    <span>다크 모드</span>
                    <button class="theme-switch" 
                            id="mobile-theme-toggle"
                            role="switch"
                            aria-checked="false"
                            aria-label="다크 모드 토글"
                            tabindex="-1">
                        <span class="theme-switch-slider" aria-hidden="true"></span>
                        <span class="sr-only">다크 모드 전환</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- 모바일 메뉴 오버레이 -->
    <div class="mobile-overlay" 
         id="mobile-overlay" 
         aria-hidden="true"
         role="presentation"></div>
    
    <!-- 메인 콘텐츠 - 접근성 landmark -->
    <main id="main-content" role="main" tabindex="-1">
        {% block content %}{% endblock %}
    </main>
    
    <!-- 푸터 - 접근성 개선 -->
    <footer role="contentinfo" aria-label="사이트 정보">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <a href="{{ url_for('main.index') }}" 
                       class="footer-logo"
                       aria-label="와구센 홈페이지로 이동">
                        <picture>
                            <source srcset="{{ url_for('static', filename='img/footer-logo.webp') }}" type="image/webp">
                            <img src="{{ url_for('static', filename='img/footer-logo.gif') }}" 
                                 alt="와구센 로고"
                                 width="40"
                                 height="40"
                                 loading="lazy"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                        </picture>
                        <span style="display: none; font-size: 20px;" aria-hidden="true">🏠</span>
                    </a>
                    <p>&copy; <span id="current-year">2024</span> 와구센. All rights reserved.</p>
                </div>
                <nav class="footer-links" aria-label="소셜 미디어 링크">
                    <a href="https://github.com/wagusen" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       aria-label="GitHub 프로필 보기 (새 창에서 열림)">
                        <i class="fab fa-github" aria-hidden="true"></i>
                        <span>GitHub</span>
                    </a>
                    <a href="mailto:contact@wagusen.com"
                       aria-label="이메일 보내기">
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                        <span>Email</span>
                    </a>
                </nav>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript 최적화 -->
    <script>
        // Critical JavaScript 인라인 (테마 관리)
        (function() {
            // FOUC 방지를 위한 테마 즉시 적용
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark-theme');
            }
            
            // 현재 연도 업데이트
            const currentYear = new Date().getFullYear();
            const yearElement = document.getElementById('current-year');
            if (yearElement) {
                yearElement.textContent = currentYear;
            }
        })();
    </script>
    
    <!-- 성능 최적화: 메인 JavaScript 지연 로딩 -->
    <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- 접근성: 스크린 리더 전용 라이브 영역 -->
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="live-region"></div>
    
    {% block scripts %}{% endblock %}
    
    <!-- 서비스 워커 등록 (PWA 지원) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>